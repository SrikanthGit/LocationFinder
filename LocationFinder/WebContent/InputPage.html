<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<!-- <script
src="http://maps.googleapis.com/maps/api/js">
</script> -->
<script 

src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"

></script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
<link rel="stylesheet" type="text/css" href="css/	LocationFinder.css">

<style type="text/css"> 
.ui-autocomplete { overflow-y: auto; width:300px; }
* html .ui-autocomplete { /* IE max- */height: expression( this.scrollHeight > 320 ? "320px" : "auto" ); }
.ui-autocomplete { max-height: 320px; }
.ui-autocomplete li { font-size:10pt; }
</style>

<script>
var mapGlobal;
var geocoderGlobal = new google.maps.Geocoder();
var markerArrayGlobal=new Array();
var boundsGlobal = new google.maps.LatLngBounds();
var prevResultGlobal="resultRow1";
var collegeObjGlobal;
var infoWindowGlobal=new google.maps.InfoWindow();


function initializeMap(address) {
	var mapTypeIds = [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID];
	var mapOptions = {   draggable:true, panControl: true,zoomControl: true, disableDoubleClickZoom:false, streetViewControl: false,  zoom:8,  mapTypeControl: true,
				mapTypeId: google.maps.MapTypeId.ROADMAP, mapTypeControlOptions : { mapTypeIds: mapTypeIds } } ; 
	mapGlobal=new google.maps.Map(document.getElementById("googleMap"), mapOptions);
   geocoderGlobal.geocode( { 'address': address}, function(results, status) 
	        {
	   if (status == google.maps.GeocoderStatus.OK) 
       {
		   mapGlobal.setCenter(results[0].geometry.location);

       }

	        });
	}
function autocompleteKeyword() {

var bounds = new google.maps.LatLngBounds();
var autocomplete;
var input = document.getElementById('inputLocation');


geocoderGlobal.geocode( { 'address': 'TamilNadu'}, function(results, status) {
	if (status == google.maps.GeocoderStatus.OK && results[0]) {
		bounds.extend(results[0].geometry.location);
		var autocomplete = new google.maps.places.Autocomplete(input);
		autocomplete.setBounds(bounds);
	} 
	else
	{
		autocomplete = new google.maps.places.Autocomplete(input);
	}
}); //end if geocoder.geocode
}


function addMarker(latitude,longitude,idx,html){
	var point = new google.maps.LatLng(latitude,longitude);
	var marker = new google.maps.Marker({
  position: point,
  //icon: image
});
markerArrayGlobal[idx] = marker;
	boundsGlobal.extend(point);
	mapGlobal.fitBounds(boundsGlobal);
	

marker.setMap(mapGlobal);
var infoWindow = new google.maps.InfoWindow({
	  content:html
	  });
google.maps.event.addListener(marker, 'click', function() {
	infoWindow.open(mapGlobal,marker);
	  });

}

function positionCenter(idx1)
{	 jQuery("#"+prevResultGlobal).css("background-color", "white");
	var rowID='resultRow'+idx1;
	jQuery("#"+rowID).css("background-color", "burlywood");
	prevResultGlobal=rowID;

	
	 for(var idx=0;idx<collegeObjGlobal.length;idx++){
		 if(idx1==idx)
			{
		 var collegeObj=collegeObjGlobal[idx];
		
		 
		 var infoBoxContent="";
		 infoBoxContent+='<div class="collResultWrapper" id="resultRow'+idx+'">';
		 infoBoxContent+='<div class="collName">'+collegeObj.name+'</div>';
		 infoBoxContent+='<div class="collDist,collResult">Distance :'+collegeObj.distance+' kms</div>';
		 infoBoxContent+='<div class="collAddress,collResult">';
		 infoBoxContent+='<div class="addressLine1">'+collegeObj.addressMap.line1+'</div>';
		 infoBoxContent+='<div class="addressLine2">'+collegeObj.addressMap.line2+'</div>';
		 infoBoxContent+='<div class="addressLine3">'+collegeObj.addressMap.city+' '+collegeObj.addressMap.state+
		 ' '+collegeObj.addressMap.zip+'</div></div>';
		 /* infoBoxContent+='<div class="collSplNote,collResult">'+collegeObj.specialNote+'</div>';
		 infoBoxContent+='<div class="collDetails,collResult">'+collegeObj.details+'</div>';
		  */
		 infoBoxContent+='<div class="collWebsite,collResult"><a href="'+collegeObj.website+'">'+collegeObj.website+'</a></div>';
		 //infoBoxContent+='<div class="collRanking,collResult"> Ranking : '+collegeObj.ranking+'</div>';
		 infoBoxContent+='<div class="collContact,collResult"> <div>Fax: '+collegeObj.contactDetails.fax;
		 infoBoxContent+='  Phone: '+collegeObj.contactDetails.phone+'</div>';
		 infoBoxContent+='<div>Email: '+collegeObj.contactDetails.email+'</div></div>';
		 infoBoxContent+='</div>';
		 var point = new google.maps.LatLng(collegeObj.latitude, collegeObj.longitude );
		 
			mapGlobal.setCenter(point);
			var marker = new google.maps.Marker({
			      position: point			      			      
			  });
		/* 	infoWindowGlobal.close();
		  infoWindowGlobal = new google.maps.InfoWindow({
			  content:infoBoxContent
			  });
		 infoWindowGlobal.open(mapGlobal,marker); */
		
			} 
	 }
	 
	
}

function showResult(point){
	
	var lat=point.lat();
    var lng=point.lng();
	var distanceSelected= $('#selectDisPref').val();
    
	jQuery.ajax({
			url:"/LocationFinder/rest/CollegeLocator/getColleges",
			data : {latitude:lat,longitude:lng,distance:distanceSelected},
			type:"POST",
			dataType: "json",
			global:false,
			success:function(result, status, jqXHR)
			{	

	// if status code is 200 (OK) then only execute the below scripts and parsing template data.
	if(jqXHR.status == '200')
{

if(result.status=="success"){
 var address=document.getElementById('inputLocation').value;
 initializeMap(address);
 
 var html="";
 collegeObjGlobal=result.collegeLocResult;
for(var idx=0;idx<result.collegeLocResult.length;idx++){
 
 var collegeObj=result.collegeLocResult[idx];


 var eachResult="";
 eachResult+='<div onclick="positionCenter('+idx+');"  onmouseover="mouseOverResult('+idx+');" class="collResultWrapper" id="resultRow'+idx+'">';
 eachResult+='<div class="collName">'+collegeObj.name+'</div>';
 eachResult+='<div class="collDist,collResult">Distance :'+collegeObj.distance+' kms</div>';
 eachResult+='<div class="collAddress,collResult">';
 if(collegeObj.addressMap.line1!=null && collegeObj.addressMap.line1!="null" && collegeObj.addressMap.line1!=""){
 eachResult+='<div class="addressLine1">'+collegeObj.addressMap.line1+'</div>';
 }
 if(collegeObj.addressMap.line2!=null && collegeObj.addressMap.line2!="null" && collegeObj.addressMap.line2!=""){
 eachResult+='<div class="addressLine2">'+collegeObj.addressMap.line2+'</div>';
 }
 eachResult+='<div class="addressLine3">'+collegeObj.addressMap.city+' '+collegeObj.addressMap.state+
 ' '+collegeObj.addressMap.zip+'</div></div>';
 if(collegeObj.specialNote!=null && collegeObj.specialNote!="null" && collegeObj.specialNote!=""){
 eachResult+='<div class="collSplNote,collResult">'+collegeObj.specialNote+'</div>';
 }
 if(collegeObj.details!=null && collegeObj.details!="null" && collegeObj.details!=""){
 eachResult+='<div class="collDetails,collResult">'+collegeObj.details+'</div>';
 }
 eachResult+='<div class="collWebsite,collResult"><a href="'+collegeObj.website+'">'+collegeObj.website+'</a></div>';
 eachResult+='<div class="collRanking,collResult"> Ranking : '+collegeObj.ranking+'  College Code : '+collegeObj.code+'</div>';
 eachResult+='<div class="collContact,collResult"> <div>Fax: '+collegeObj.contactDetails.fax;
 eachResult+='  Phone: '+collegeObj.contactDetails.phone+'</div>';
 eachResult+='<div>Email: '+collegeObj.contactDetails.email+'</div></div>';
 eachResult+='</div>';
 
 
 var infoBoxContent="";
 infoBoxContent+='<div class="collResultWrapper" id="resultRow'+idx+'">';
 infoBoxContent+='<div class="collName">'+collegeObj.name+'</div>';
 infoBoxContent+='<div class="collDist,collResult">Distance :'+collegeObj.distance+' kms</div>';
 infoBoxContent+='<div class="collAddress,collResult">';
 infoBoxContent+='<div class="addressLine1">'+collegeObj.addressMap.line1+'</div>';
 infoBoxContent+='<div class="addressLine2">'+collegeObj.addressMap.line2+'</div>';
 infoBoxContent+='<div class="addressLine3">'+collegeObj.addressMap.city+' '+collegeObj.addressMap.state+
 ' '+collegeObj.addressMap.zip+'</div></div>';
 /* infoBoxContent+='<div class="collSplNote,collResult">'+collegeObj.specialNote+'</div>';
 infoBoxContent+='<div class="collDetails,collResult">'+collegeObj.details+'</div>';
  */
 infoBoxContent+='<div class="collWebsite,collResult"><a href="'+collegeObj.website+'">'+collegeObj.website+'</a></div>';
 //infoBoxContent+='<div class="collRanking,collResult"> Ranking : '+collegeObj.ranking+'</div>';
 infoBoxContent+='<div class="collContact,collResult"> <div>Fax: '+collegeObj.contactDetails.fax;
 infoBoxContent+='  Phone: '+collegeObj.contactDetails.phone+'</div>';
 infoBoxContent+='<div>Email: '+collegeObj.contactDetails.email+'</div></div>';
 infoBoxContent+='</div>';
 

 addMarker(collegeObj.latitude,collegeObj.longitude,idx,infoBoxContent);
 html+=eachResult;
 
}



if(markerArrayGlobal.length > 1)
{
	mapGlobal.setZoom(mapGlobal.getZoom()+2);
	
	positionCenter(0);
}
else
{
	mapGlobal.setZoom(mapGlobal.getZoom()-4);
}



$("#resultBox").html(html);

$("#resultWrapper").show();
}
else{
	
		alert('There are no results found. Please try again');
	
}

}
	else{
		alert('There is some error while processing request. Please try again');
	}
}

});
}
function mouseOverResult(idx){
	jQuery("#"+prevResultGlobal).css("background-color", "white");
	var rowID='resultRow'+idx;
	jQuery("#"+rowID).css("background-color", "lightgoldenrodyellow");
	prevResultGlobal=rowID;
}


$().ready(function() {
	
	$("#resultWrapper").hide();
	




autocompleteKeyword();

$("#locateButton").click(function(){
	
	//var jsonData='{"status":"success","collegeLocResult":[{"latitude":"13.00864","longitude":"80.00420","name":"Rajalakshmi Engineering College","address":"Rajalakshmi Nagar, Thandalam, Chennai, Tamil Nadu 602105, India","details":"Rajalakshmi college is a very good college","specialNote":"Techfest in next 2 months ","website":"www.rec.com","ranking":1,"distance":0.62,"addressMap":{"zip":"602105","state":"TAMILNADU","country":"India","city":"CHENNAI","line1":"Rajalakshmi Nagar","line2":"Thandalam"},"contactDetails":{"fax":"0000000000","email":"rec@rec.com","phone":"0000000000"}},{"latitude":"12.93089","longitude":"80.04476","name":"Dhanalakshmi Engineering College","address":"Rajalakshmi Nagar, Thandalam, Chennai, Tamil Nadu 602105, India","details":"Dhanalakshmi college is a very good college","specialNote":"Techfest in next 2 months ","website":"www.rec.com","ranking":3,"distance":0.63,"addressMap":{"zip":"602105","state":"TAMILNADU","country":"India","city":"CHENNAI","line1":"Rajalakshmi Nagar","line2":"Thandalam"},"contactDetails":{"fax":"0000000000","email":"rec@rec.com","phone":"0000000000"}},{"latitude":"13.01300","longitude":"80.23538","name":"Guindy Engineering College","address":"Rajalakshmi Nagar, Thandalam, Chennai, Tamil Nadu 602105, India","details":"Guindy Engineering  college is a very good college","specialNote":"Techfest in next 2 months ","website":"www.rec.com","ranking":2,"distance":0.65,"addressMap":{"zip":"602105","state":"TAMILNADU","country":"India","city":"CHENNAI","line1":"Rajalakshmi Nagar","line2":"Thandalam"},"contactDetails":{"fax":"0000000000","email":"rec@rec.com","phone":"0000000000"}}]}';
	//var result=JSON.parse(jsonData);
	
	//$.getJSON("jsonResult.js",function(result){
		var inputAddress=document.getElementById('inputLocation').value;
	geocoderGlobal.geocode( { 'address': inputAddress}, function(results, status) {
	if (status == google.maps.GeocoderStatus.OK && results[0]) {
				
		showResult(results[0].geometry.location);
	} 
	else
	{
		alert('There are no results for entered address. Please try again.');
	}
});	
		
			 
		
	     
	// });
});

});


//google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>
<div id="branding">
<img src="images/head.gif" id="brandingImage">

</div>
<div id="Header">
Anna University Colleges Location Finder
</div>
<div id="HeaderLine">
<h2 id="HeaderLine" class="headerLine">   </h2>
</div>
<form id="locatorForm" class="locatorForm">

<div id="formTop">
<div id= "inputDiv">
<div id="inputLocMsg">
Please enter the location to find nearyby colleges	
</div>
<div id="inputLoc">
<input type="text"  placeholder="Enter a location" name="inputLocation" 
id="inputLocation" class="inputLocation"/>

<span>
within 

<select id="selectDisPref" name="selectDisPref"  

class="selectDisPref" >
  <option value="5">5</option>
  <option selected="selected"  value="10">10</option>
  <option value="25">25</option>
 
  <option value="50">50</option>
  </select>
  kms
</span>
</div>
</div>
<!-- 
<div id="messageSep">
OR
</div>
<div id="selectColleges">

<span id="selectCollegeMsg">
Please select the college of your preference 
</span>
<span id="collegesList">

<select id="selectColleges" name="selectColleges"  

class="selectColleges" style="font-family: Arial, Helvetica, sans-

serif; font-weight: normal; font-size: 10px;">
  <option value="C1">College1</option>
  <option value="C2">College2</option>
  <option value="C3">College3</option>
 
  <option selected="selected" value="C4">Rajalakshmi Engineering 

College</option>
 
</select>
</span>
</div>
 -->
<div id="locateButton">
<input type="button" value="Locate College" />
</div>
</div>
<div id="resultWrapper">

<div id="resultText">
Search Result :
</div>
<span>
<div id="resultBox">
<!-- <div id="result1" style="float:left;width:300px;height:450px;">

</div> -->
</div>

<div id="googleMap" style="margin-left:400px;height:300px;">
</div>
</span>

</div>





</form>
</body>

<div id="Footer" class="disclaimer" style="float:left;padding-bottom:10px;">
<span id="disclaimer" class="disclaimer">
The information in website are for planning purposes only. You may 

find that construction projects, traffic, weather, or other events may 

cause conditions to differ from the map results, and you should plan 

your route accordingly. You must obey all signs or notices regarding 

your route.
</span>
</div>
</html>
